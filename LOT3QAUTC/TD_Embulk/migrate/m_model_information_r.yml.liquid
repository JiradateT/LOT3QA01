{% include 'config' %}

in:
  type: {{in_type}}
  driver_path: {{in_driver_path}}
  host: {{mig_in_host}}
  user: {{mig_in_user}}
  password: {{mig_in_password}}
  database: {{mig_in_database}}
  fetch_rows: 3000
  query: |
    SELECT 
        ModelId as model_id,
        ModelCode as model_code,
        ModelMasterId as model_master_id,
        ModelName as model_name,
        ModelShortName as model_short_name,
        ModelYear as model_year,
        ModelMaster_IsActive as model_master_is_active,
        ModelGroupId as model_group_id,
        ModelGroupCode as model_group_code,
        ModelGroupDescription as model_group_description,
        ModelColorId as model_color_id,
        ModelColorCode as model_color_code,
        ModelColorName as model_color_name,
        ColorTypeId as color_type_id,
        ColorTypeCode as color_type_code,
        Description as description,
        ModelOptionId as model_option_id,
        ModelOptionCode as model_option_code,
        ModelOptionName as model_option_name,
        FuelTypeId as fuel_type_id,
        EngineModel as engine_model,
        FuelSplTypeId as fuel_spl_type_id,
        NoOfCylinders as no_of_cylinders,
        NoOfHPMarket as no_of_hp_market,
        ThaiModelNameId as thai_model_name_id,
        DisplacementActual as displacement_actual,
        DisplacementMarket as displacement_market,
        TransmissionId as transmission_id,
        SteeringId as steering_id,
        DoorId as door_id,
        AirbagId as airbag_id,
        AbsId as abs_id,
        DriveSystemId as drive_system_id,
        HeadLampId as head_lamp_id,
        HorsePower as horse_power,
        WbaseTypeId as wbase_type_id,
        Wbase as wbase,
        SeriesName as series_name,
        GrossVehicleWeight as gross_vehicle_weight,
        EngineTurboCooler as engine_turbo_cooler,
        SeatType as seat_type,
        VersionName as version_name,
        CabType as cab_type,
        Torque as torque,
        Feature as feature,
        TonClassId as ton_class_id,
        FinalTypeId as final_type_id,
        SpecialSpecId as special_spec_id,
        RevisionId as revision_id,
        Tire as tire,
        TransmissionSpeed as transmission_speed,
        GrossCombinationWeight as gross_combination_weight,
        ColorInterior as color_interior,
        SeatColor as seat_color,
        LeaseMaintennacePackageId as lease_maintennace_package_id,
        IsAccessoryFlag as is_accessory_flag,
        FutureUseId as future_use_id,
        VehicleTypeId as vehicle_type_id,
        Segment1Code as segment1_code,
        Segment2 as segment2,
        SubModelGroup1 as sub_model_group1,
        ModelSubGroup1_Code as model_sub_group1_code,
        ModelSubGroup1_Description as model_sub_group1_description,
        SubModelGroup2 as sub_model_group2,
        ModelSubGroup2_Code as model_sub_group2_code,
        ModelSubGroup2_Description as model_sub_group2_description,
        FactoryGrade as factory_grade,
        GenGradeId as gen_grade_id,
        Class1MarketingGrade as class1_marketing_grade,
        Class2MarketingName as class2_marketing_name,
        HorsePowerType as horse_power_type,
        GearMarketName as gear_market_name,
        EuropeanEmissionStd as european_emission_std,
        Audio as audio,
        DevelopCode as develop_code,
        GPSContractId as gps_contract_id,
        CabSuspensionId as cab_suspension_id,
        HiRideId as hi_ride_id,
        FuelTypeSdId as fuel_type_sd_id,
        SuffixCode as suffix_code,
        BomSetOptionId as bom_set_option_id,
        BomPrice as bom_price,
        BrandId as brand_id,
        SalesRecordModel as sales_record_model,
        VwVehicleWeight as vw_vehicle_weight,
        SpecialSpecProdId as special_spec_prod_id,
        FinalGearRatio as final_gear_ratio,
        StickerTypeId as sticker_type_id,
        LTGGroup as ltg_group,
        OwnerManual as owner_manual,
        PartCatalog as part_catalog,
        BreakSystemId as break_system_id,
        ModelGroupForSalesTarget as model_group_for_sales_target,
        SpecialToolsCatalog as special_tools_catalog,
        ParentCodeId as parent_code_id,
        WorkshopManual as workshop_manual,
        MmVariantCondition as mm_variant_condition,
        SdVariantCondition1 as sd_variant_condition1,
        WarrantyVariantCondition as warranty_variant_condition,
        SdVariantCondition2 as sd_variant_condition2,
        SdVariantCondition3 as sd_variant_condition3,
        BomSetByModelId as bom_set_by_model_id,
        SdVariantCondition4 as sd_variant_condition4,
        ProductModelName as product_model_name,
        BookNumber as book_number,
        OrderEffectiveFrom as order_effective_from,
        OrderEffectiveTo as order_effective_to,
        SalesEffectiveFrom as sales_effective_from,
        SalesEffectiveTo as sales_effective_to,
        SpecialModelFlag as special_model_flag,
        AccessoryFlagDescription as accessory_flag_description,
        GenGradeDescription as gen_grade_description,
        BKEffectiveDate as bk_effective_date,
        RSEffectiveDate as rs_effective_date,
        ModelGroup_IsActive as model_group_is_active,
        ModelOption_IsActive as model_option_is_active,
        ModelColor_IsActive as model_color_is_active
    from (
    SELECT 
         MD.ModelId
        ,MM.ModelMasterId
        ,MM.ModelCode
        ,MM.ModelName
        ,MM.ModelShortName
        ,MD.ModelYear
        ,MM.IsActive AS ModelMaster_IsActive

        ,MG.ModelGroupId
        ,MG.ModelGroupCode
        ,MG.ModelGroupDescription

        ,MCM.ModelColorId
        ,MCM.ModelColorCode
        ,MCM.ModelColorName

        ,CTM.ColorTypeId
        ,CTM.ColorTypeCode
        ,CTM.Description

        ,MOM.ModelOptionId
        ,MOM.ModelOptionCode
        ,MOM.ModelOptionName

        ,MD.FuelTypeId
        ,MD.EngineModel
        ,MD.FuelSplTypeId
        ,MD.NoOfCylinders
        ,MD.NoOfHPMarket
        ,MD.ThaiModelNameId
        ,MD.DisplacementActual
        ,MD.DisplacementMarket
        ,MD.TransmissionId
        ,MD.SteeringId
        ,MD.DoorId
        ,MD.AirbagId
        ,MD.AbsId
        ,MD.DriveSystemId
        ,MD.HeadLampId
        ,MD.HorsePower
        ,MD.WbaseTypeId
        ,MD.Wbase
        ,MD.SeriesName
        ,MD.GrossVehicleWeight
        ,MD.EngineTurboCooler
        ,MD.SeatType
        ,MD.VersionName
        ,MD.CabType
        ,MD.Torque
        ,MD.Feature
        ,MD.TonClassId
        ,MD.FinalTypeId
        ,MD.SpecialSpecId
        ,MD.RevisionId
        ,MD.Tire
        ,MD.TransmissionSpeed
        ,MD.GrossCombinationWeight
        ,MD.ColorInterior
        ,MD.SeatColor
        ,MD.LeaseMaintennacePackageId
        ,MD.IsAccessoryFlag
        ,MD.FutureUseId
        ,MD.VehicleTypeId
        ,LMLV1.ListValue AS VehicleType
        ,MD.Segment1Code
        ,MD.Segment2
        ,MD.SubModelGroup1
        ,MSG1.ModelSubGroupCode        	 AS ModelSubGroup1_Code
        ,MSG1.ModelSubGroupDescription	 AS ModelSubGroup1_Description

        ,MD.SubModelGroup2
        ,MSG2.ModelSubGroupCode        	  AS ModelSubGroup2_Code
        ,MSG2.ModelSubGroupDescription	  AS ModelSubGroup2_Description

        ,MD.FactoryGrade
        ,MD.GenGradeId
        ,MD.Class1MarketingGrade
        ,MD.Class2MarketingName
        ,MD.HorsePowerType
        ,MD.GearMarketName
        ,MD.EuropeanEmissionStd
        ,MD.Audio
        ,MD.DevelopCode
        ,MD.GPSContractId
        ,MD.CabSuspensionId
        ,MD.HiRideId
        ,MD.FuelTypeSdId
        ,MD.SuffixCode
        ,MD.BomSetOptionId
        ,MD.BomPrice
        ,MD.BrandId
        ,MD.SalesRecordModel
        ,MD.VwVehicleWeight
        ,MD.SpecialSpecProdId
        ,MD.FinalGearRatio
        ,MD.StickerTypeId
        ,MD.LTGGroup
        ,MD.OwnerManual
        ,MD.PartCatalog
        ,MD.BreakSystemId
        ,MD.ModelGroupForSalesTarget
        ,MD.SpecialToolsCatalog
        ,MD.ParentCodeId
        ,MD.WorkshopManual
        ,MD.MmVariantCondition
        ,MD.SdVariantCondition1
        ,MD.WarrantyVariantCondition
        ,MD.SdVariantCondition2
        ,MD.SdVariantCondition3
        ,MD.BomSetByModelId
        ,MD.SdVariantCondition4
        ,MD.ProductModelName
        ,MD.BookNumber
        ,MD.OrderEffectiveFrom
        ,MD.OrderEffectiveTo
        ,MD.SalesEffectiveFrom
        ,MD.SalesEffectiveTo
        ,MD.SpecialModelFlag
        ,MD.AccessoryFlagDescription
        ,MD.GenGradeDescription
        ,MD.BKEffectiveDate
        ,MD.RSEffectiveDate

        ,MG.IsActive AS ModelGroup_IsActive
        ,MOM.IsActive AS ModelOption_IsActive
        ,MCM.IsActive AS ModelColor_IsActive

    FROM CM.ModelDetails MD WITH (NOLOCK) 
     LEFT JOIN CM.ModelMaster MM WITH (NOLOCK) ON MM.ModelMasterId = MD.ModelMasterId 
     LEFT JOIN CM.ModelGroups MG WITH (NOLOCK) ON MG.ModelGroupId = MD.ModelGroupId 
     LEFT JOIN CM.ModelColorMaster MCM WITH (NOLOCK) ON MCM.ModelColorId = MD.ModelColorId
     LEFT JOIN CM.ColorTypeMaster CTM WITH (NOLOCK) ON CTM.ColorTypeId = MD.ColorTypeId

     LEFT JOIN CM.LOVMasterLanguageValues LMLV1 WITH (NOLOCK) ON LMLV1.LanguageId = 'EN-US' AND LMLV1.ListRecordId = MD.VehicleTypeId

     LEFT JOIN CM.ModelOptionMaster MOM WITH (NOLOCK) ON MOM.ModelOptionId = MD.ModelOptionId
     LEFT JOIN CM.ModelSubGroups MSG1 WITH (NOLOCK) ON MSG1.ModelSubGroupId = MD.SubModelGroup1
     LEFT JOIN CM.ModelSubGroups MSG2 WITH (NOLOCK) ON MSG2.ModelSubGroupId = MD.SubModelGroup2
    ) aa

filters:
- type: add_time
  to_column: {name: time, type: timestamp}
  from_value: {mode: upload_time}


out:
  type: td
  apikey: {{out_APIKEY}}
  endpoint: api.treasuredata.com
  database: {{out_database}}
  table: r_model_information
  time_column: time
  mode: replace
  default_timestamp_format: '%Y-%m-%d %H:%M:%S'
  stamp_format: '%Y-%m-%d %H:%M:%S'